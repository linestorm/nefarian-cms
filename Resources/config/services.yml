parameters:
  nefarian_core.config_manager.class:        Nefarian\CmsBundle\Configuration\ConfigManager
  nefarian_core.menu_manager.class:          Nefarian\CmsBundle\Menu\MenuManager
  nefarian_core.content_manager.class:       Nefarian\CmsBundle\Content\ContentManager
  nefarian_core.content_field_manager.class: Nefarian\CmsBundle\Content\Field\FieldManager
  nefarian_core.user_manager.class:          Nefarian\CmsBundle\User\UserManager
  nefarian_core.asset_manager.class:         Nefarian\CmsBundle\Assetic\NefarianAssetManager
  nefarian_core.editor_manager.class:        Nefarian\CmsBundle\Editor\EditorManager
  nefarian_core.plugin_manager.class:        Nefarian\CmsBundle\Plugin\PluginManager

  nefarian_core.twig.assets_extension:       Nefarian\CmsBundle\Twig\PluginExtension

  # Views
  nefarian_core.views.manager.class:         Nefarian\CmsBundle\View\ViewManager

  # Routing
  nefarian_core.routing.plugin_loader.class: Nefarian\CmsBundle\Router\PluginLoader
  nefarian_core.routing.api_loader.class:    Nefarian\CmsBundle\Router\ApiLoader
  nefarian_core.routing.web_loader.class:    Nefarian\CmsBundle\Router\webLoader

  # Theming
  nefarian_core.theme_manager.class:  Nefarian\CmsBundle\Theme\ThemeManager
  nefarian_core.theme_loader.class:   Nefarian\CmsBundle\Twig\Loader\ThemeLoader
  nefarian_core.plugin_loader.class:  Nefarian\CmsBundle\Twig\Loader\PluginLoader

  templating.form_template_manager.class: Nefarian\CmsBundle\Form\FormTemplateManager

  # override the asset factory
  assetic.asset_factory.class: Nefarian\CmsBundle\Assetic\Factory\NefarianAssetFactory

services:

  #
  # Cache management
  nefarian_core.cache:
    class: Nefarian\CmsBundle\Cache\CacheManager
    arguments:
      - @nefarian_core.cache.phpfile

  nefarian_core.cache.phpfile:
    class: Nefarian\CmsBundle\Cache\Provider\SerializedPhpFileCacheProvider
    arguments:
      - %kernel.cache_dir%/nefarian

  #
  # Managers
  nefarian_core.config_manager:
    class: %nefarian_core.config_manager.class%
    arguments:
      - @doctrine.orm.default_entity_manager
      - @nefarian_core.cache
      - @event_dispatcher

  nefarian_core.menu_manager:
    class: %nefarian_core.menu_manager.class%

  nefarian_core.content_manager:
    class: %nefarian_core.content_manager.class%
    arguments:
      - @nefarian_core.content_field_manager

  nefarian_core.content_type_manager:
    class: %nefarian_core.content_manager.class%
    arguments:
      - @nefarian_core.content_field_manager

  nefarian_core.content_field_manager:
    class: %nefarian_core.content_field_manager.class%

  nefarian_core.user_manager:
    class: %nefarian_core.user_manager.class%

  nefarian_core.asset_manager:
    class: %nefarian_core.asset_manager.class%

  nefarian_core.editor_manager:
    class: %nefarian_core.editor_manager.class%

  nefarian_core.plugin_manager:
    class: %nefarian_core.plugin_manager.class%
    arguments:
      - @nefarian_core.cache

  #
  # Plugin - Routing
  nefarian_core.routing.plugin_loader:
    class: %nefarian_core.routing.plugin_loader.class%
    tags:
      - { name: routing.loader }
  nefarian_core.routing.api_loader:
    class: %nefarian_core.routing.api_loader.class%
    tags:
      - { name: routing.loader }
  nefarian_core.routing.web_loader:
    class: %nefarian_core.routing.web_loader.class%
    tags:
      - { name: routing.loader }

  nefarian_core.routing.route_provider:
    class: Nefarian\CmsBundle\Router\NefarianRouteProvider
    arguments:
      - @doctrine.orm.default_entity_manager


  #
  # Views
  nefarian_core.views.manager:
    class: %nefarian_core.views.manager.class%
    arguments: [@doctrine.orm.default_entity_manager]

  #
  # Twig Functions for plugins
  nefarian_core.twig.assets_extension:
    class: %nefarian_core.twig.assets_extension%
    arguments:
      - @nefarian_core.asset_manager
    tags:
      - { name: twig.extension }


  #
  # Plugin - Twig Loader
  twig.loader.plugin_loader:
    class: %nefarian_core.plugin_loader.class%
    arguments:
      - @templating.locator
      - @templating.name_parser
    tags:
      - { name: twig.loader }


  #
  # Theming
  nefarian_core.theme_manager:
    class: %nefarian_core.theme_manager.class%

  twig.loader.theme_loader:
    class: %nefarian_core.theme_loader.class%
    arguments:
      - @nefarian_core.theme_manager
      - @templating.locator.theme_filesystem_locator
      - @templating.name_parser
    tags:
      - { name: twig.loader }

  #
  # Template loader!
  templating.locator.theme_locator:
    class: Nefarian\CmsBundle\Templating\Locator\ThemeLocator
    arguments:
      - @nefarian_core.theme_manager

  templating.locator.theme_filesystem_locator:
    class: %templating.locator.class%
    arguments:
      - @templating.locator.theme_locator
      - %kernel.cache_dir%

  templating.loader.theme_loader:
    class: %templating.loader.filesystem.class%
    arguments:
      - @templating.locator.theme_locator

  templating.form_template_manager:
    class: %templating.form_template_manager.class%
